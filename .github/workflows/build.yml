name: Build
on:
        push:
                branches:
                        - main
                # paths:
                #         - "front/**" # monorepo projects paths from the monorepo root directory
                #         - "server/**"
        pull_request:
                types: [opened, synchronize, reopened]
jobs:
        sonarcloud:
                name: SonarCloud
                runs-on: ubuntu-latest
                steps:
                        - uses: actions/checkout@v4
                          with:
                                  fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis
                        - name: SonarCloud Scan
                          uses: SonarSource/sonarcloud-github-action@master
                          env:
                                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # Needed to get PR information, if any
                                  SONAR_TOKEN: ${{ secrets.SONAR_TOKEN_FRONT }}
                          with:
                                  projectBaseDir: front/
        sonarcloud-server:
                name: SonarCloudServer
                runs-on: ubuntu-latest
                defaults:
                        run:
                                working-directory: ./server
                steps:
                        - uses: actions/checkout@v4
                          with:
                                  fetch-depth: 0
                        - name: Use Node.js
                          uses: actions/setup-node@v4
                          with:
                                  node-version: "20.x"
                        - name: Install dependencies
                          run: npm install
                        - name: Generate coverage files
                          run: npm run test:cov
                        - name: SonarCloud Scan
                          uses: SonarSource/sonarcloud-github-action@master
                          env:
                                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                                  SONAR_TOKEN: ${{ secrets.SONAR_TOKEN_SERVER }}

                          with:
                                  projectBaseDir: server/
